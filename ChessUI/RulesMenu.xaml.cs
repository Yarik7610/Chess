using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Input;
using System.Windows.Media;
using System.Windows.Media.Imaging;
using System.Windows.Navigation;
using System.Windows.Shapes;

namespace ChessUI
{
    public partial class RulesMenu : UserControl
    {
        public event Action<Option> OptionSelected;
        private string enText = "Game Objective:\r\nTo take the opponent's king by checkmate.\r\n\r\nPlacement of pieces:\r\nBefore the game starts, each player has 16 pieces at his disposal, which are placed: \r\nWhite pieces are placed on the 1st and 2nd horizontals, and Black pieces on the 7th and 8th horizontals. Both sides have:\r\n• 8 pawns (placed in the second row before all other pieces);\r\n• 2 rooks (occupy corner squares on the left and right);\r\n• 2 knights (occupy spaces next to the rooks);\r\n• 2 bishops (take places next to the knights);\r\n• queen (occupies the central square of its color);\r\n• king (takes a place next to the queen).\r\n\r\nMovements of pieces, castling, capture on the passage (en passant):\r\n• King except for castling moves from its own square to one of the free adjacent squares, which is not under the attack of the opponent's pieces. Castling is performed as follows: the king moves from his starting square two squares horizontally, and the rook is placed on the square crossed by the king; thus the king is behind the rook from which he castled. Castling is definitively impossible if the king moved during the game. Also castling is impossible with a rook that has already moved. Castling is temporarily impossible if the square on which the king is, or the square he must cross or occupy, is under attack by an opponent's piece. Castling is also impossible if there is another piece - own or opponent's piece - on the horizontal line between the king and the corresponding rook;\r\n• Queen moves along the verticals, diagonals and horizontals on which it is located. Historically a weak piece: initially he could walk only diagonally for one square, then he moves as a knight to the nearest square, if there is no piece in his way;\r\n• Rook moves along the verticals and horizontals on which it is located;\r\n• Bishop walks on the diagonals on which it stands;\r\n• Knight can move to one of the fields closest to the one on which he stands, but not on the same horizontal, vertical or diagonal;\r\n• Pawn moves one field forward only, except for capture. From the starting position, a pawn can go either one or two squares forward. The pawn can take any opponent's piece (except the king), which is located ahead of it one square diagonally. If a pawn makes the first move at once on two squares and after the move is in one horizontal next to the opponent's pawn, it can be taken by this pawn; then the latter moves to the field through which the knocked down pawn moved. This capture is called \"capture on the passage\". It can be realized only immediately after the opponent made such a move. Any pawn, reaching the extreme horizontal, must be the same move replaced by a queen, rook, bishop or knight of the same color as the pawn.\r\n\r\nCheck:\r\nA check to the king occurs when the field he occupies is under attack by enemy pieces.\r\nA check to the king must be repulsed by the next move. A check can be repulsed in one of the following ways:\r\n• Retreat the king to a field that is not under attack by the opponent's pieces;\r\n• Take a piece that threatens the king;\r\n• Cover the king by placing another of your pieces on the field between the king and the piece that is attacking him.\r\nThe second and third methods of defense are impossible if double check is declared, and it is also impossible to cover the king with a piece if the knight is attacking.\r\nIf check cannot be defended with the next move, checkmate is declared, and the player who checkmated is declared the winner of the game.\r\n\r\nCases of victory:\r\n• Checkmate;\r\n• The opponent's time has expired;\r\n• The opponent has surrendered.\r\n\r\nDraw Cases:\r\n• Stalemate;\r\n• Threefold Repetition: The arrangement of pieces on a chessboard is repeated three times. In chess, for positions to be considered the same, each player must have the same possibilities of moves each time, including possible rights to castling and taking on passage. Positions are considered the same if the same type of piece stands on the same square. In this case only the fact of occupation by a piece of this dignity of a particular board square is taken into account, so, for example, if two white knights have changed places - it is still considered that the position is repeated. To fix a draw, a player who has noticed a threefold repetition of a position and wishes to stop the game on a draw may address the referee;\r\n• Rule of 50 moves (during 50 own moves no piece has been taken and no pawn has made a move).\r\n• Insufficient material (not enough pieces from both sides to make a checkmate).";
        private string ruText = "Цель игры:\r\nВзять короля противника матом.\r\n\r\nРасстановка фигур:\r\nПеред началом игры каждый игрок имеет в распоряжении 16 фигур, которые располагаются: Белые фигуры располагаются на 1 и 2 горизонталях, а черные на 7 и 8. У каждой стороны:\r\n• 8 пешек (размещаются во втором ряду перед всеми остальными фигурами);\r\n• 2 ладьи (занимают угловые клетки слева и справа);\r\n• 2 коня (занимают места рядом с ладьями);\r\n• 2 слона (занимают места рядом с конями);\r\n• ферзь (занимает центральную клетку своего цвета);\r\n• король (занимает место рядом с ферзем).\r\n\r\nХоды фигур, рокировка, взятие на проходе:\r\n• Король, за исключением рокировки, передвигается со своего поля на одно из свободных смежных полей, которое не находится под ударом фигур соперника. Рокировка выполняется следующим образом: король перемещается со своего стартового поля на две клетки по горизонтали, а ладья при этом устанавливается на поле, которое пересёк король; таким образом, король оказывается за ладьёй, с которой он сделал рокировку. Рокировка окончательно невозможна, если король во время партии двигался. Также рокировка невозможна с ладьёй, которая уже двигалась. Рокировка временно невозможна, если поле, на котором находится король, или поле, которое он должен пересечь или занять, находится под ударом фигуры соперника. Также рокировка невозможна, если на горизонтали между королём и соответствующей ладьёй есть другая фигура — собственная или фигура соперника;\r\n• Ферзь ходит по вертикалям, диагоналям и горизонталям, на которых он находится. Исторически слабая фигура: изначально мог ходить только по диагонали на одну клетку, далее ходил как конь на ближайшее поле, если на его пути не стоит фигура;\r\n• Ладья ходит по вертикалям и горизонталям, на которых она находится.\r\n• Слон ходит по диагоналям, на которых он находится;\r\n• Конь может пойти на одно из полей, ближайших к тому, на котором он стоит, но не на той же самой горизонтали, вертикали или диагонали;\r\n• Пешка передвигается на одно поле только вперёд, за исключением взятия. Со стартовой позиции пешка может пойти как на одну, так и на две клетки вперёд. Пешка может взять любую фигуру соперника (кроме короля), которая расположена впереди неё на одну клетку по диагонали. Если пешка делает первый ход сразу на две клетки и после хода оказывается в одной горизонтали рядом с пешкой соперника, то она может быть взята этой пешкой; тогда последняя переходит на поле, через которое перешла сбитая пешка. Это взятие называется «взятие на проходе». Оно может быть осуществлено только сразу после того, как соперник сделал такой ход. Любая пешка, достигающая крайней горизонтали, должна быть тем же ходом заменена на ферзя, ладью, слона или коня того же цвета, что и пешка.\r\n\r\nШах:\r\nШах королю имеет место, когда поле, которое он занимает, оказалось под ударом фигур противника.\r\nШах королю должен быть отражён следующим ходом. Шах можно отбить одним из следующих способов:\r\n• Отойти королём на поле, которое не находится под ударом фигур соперника;\r\n• Взять фигуру, которая угрожает королю;\r\n• Прикрыть короля, поставив другую свою фигуру под удар на поле, находящееся между королём и фигурой, которая его атакует.\r\nВторой и третий способ защиты невозможны, если объявлен двойной шах, а также невозможно прикрыть короля фигурой, если атакует конь.\r\nЕсли шах невозможно отразить следующим ходом, то объявляется мат, и игрок, который поставил мат, объявляется победителем партии.\r\n\r\nСлучаи победы:\r\n• Мат;\r\n• У противника истекло время;\r\n• Противник сдался.\r\n\r\nСлучаи ничьи:\r\n• Пат;\r\n• Троекратное повторение: Три раза повторяется расстановка фигур на шахматной доске. В шахматах для того, чтобы позиции считались одинаковыми, каждый игрок должен иметь те же возможности ходов каждый раз, включая возможные права на рокировки и взятие на проходе. Позиции считаются одинаковыми, если один и тот же тип фигуры стоит на той же клетке. При этом учитывается лишь факт занятия фигурой данного достоинства конкретного поля доски, так, например, если два белых коня поменялись местами — всё равно считается, что позиция повторилась. Для фиксации ничьей игрок, заметивший троекратное повторение позиции и желающий остановить игру на ничейном результате, может обратиться к судье;\r\n• Правило 50 ходов (на протяжении 50 собственных ходов ни одна фигура не была взята и ни одна пешка не сделала хода).\r\n• Недостаточность материала (не достаточно фигур у обеих сторон чтобы поставить мат).";
        public RulesMenu(bool isRussian)
        {
            InitializeComponent();
            RulesTextBlock.Text = isRussian ? ruText : enText;
            RulesMenuHl.Text = isRussian ? "Правила" : "Rules";
            RulesContinueBtn.Content = isRussian ? "Продолжить" : "Continue";
        }

        private void Continue_Click(object sender, RoutedEventArgs e)
        {
            OptionSelected?.Invoke(Option.Continue);
        }
    }
}
